all:
	mkdir -p ./build
	xcrun -sdk iphoneos clang -c -o ./build/utils.o ./utils/utils.c -target arm64-apple-darwin -Wall -static -I./utils -nostdlib -fno-stack-protector -fpic -Os
	xcrun -sdk iphoneos clang -c -o ./build/main.o ./main.s -target arm64-apple-darwin -Wall -static -I./utils -nostdlib -fno-stack-protector -fpic -Os
	xcrun -sdk iphoneos clang -c -o ./build/hooks.o ./hooks.c -target arm64-apple-darwin -Wall -static -I./utils -nostdlib -fno-stack-protector -fpic -Os
	xcrun -sdk iphoneos clang -c -o ./build/iBoot_patcher.o ./iBoot_patcher.c -target arm64-apple-darwin -Wall -static -I./utils -nostdlib -fno-stack-protector -fpic -Os
	xcrun -sdk iphoneos clang -c -o ./build/kernel_patcher.o ./kernel_patcher.c -target arm64-apple-darwin -Wall -static -I./utils -nostdlib -fno-stack-protector -fpic -Os

	cd ./build && xcrun -sdk iphoneos clang -target arm64-apple-darwin -o ./boot_companion main.o hooks.o iBoot_patcher.o kernel_patcher.o utils.o -fno-stack-protector -fpic -Os
	cd ./build && macho_text ./boot_companion ../../bin/boot_companion.text